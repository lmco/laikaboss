####################################################################################
# General
####################################################################################
# This section contains general configuration options for the Laika framework
####################################################################################

[General]

cluster = cluster1
hostname = localhost
laika_head_node = {{ hostname }}

#config file(s) to apply last 
siteconfig = {{ laika_config_base }}/laika_cluster.conf

#redis  url
redis_url = rediss://file:{{ redis_secret_file }}@{{ laika_head_node }}:6379/?ssl_cert_reqs=required&ssl_ca_certs={{ ca_certificate }}

numprocs = 12

# Combined TLS ca cert file used by all components both for clients or servers
ca_certificate={{ laika_config_base }}/secrets/cacert.crt

# Path to the first pass dispatcher rules.
YaraDispatchRules={{ laika_config_base }}/dispatch.yara

# Path to the second pass dispatcher.
YaraConditionalRules={{ laika_config_base }}/conditional-dispatch.yara

# Disposition Rule Prefix - rules to return in DispositionReason
DispositionReasonPrefix=yara

# The default priority a module is given for execution order.
# If a value is not specified in the dispatcher, this one is used.
defaultModulePriority=9

# The maximum depth to recurse an object. A value of zero indicates no limit.
maxdepth=10

# The maximum amount of time (in seconds) to spend scanning a single object.
global_scan_timeout=3600

# The maximum amount of time (in seconds) to spend in module by default.
global_module_timeout=600

# A globally defined temporary directory used by the framework and modules.
# often based on tmpfs and based out of RAM - it is fast but size limited
tempdir=/dev/shm/laikaboss_tmp

# A globally defined temporary directory used by the framework and modules .
# which runs off disk - its slower but can handle larger files
large_tempdir=/var/laikaboss/tmp

explodeemlcreatehybrid = True 

# use uuid1
scanobjectuuid=uuid1

# Default object hash method
objectHashMethod=sha256

# used by laika.py to look up items from storage for rescanning
storage_rest_api=https://{{ laika_head_node }}:443

geoip_dbpath={{ laika_config_base }}/modules/geoip/GeoLite2-City.mmdb

storage_bucket=storage
storage_secure=True
storage_url=https://file:{{ storage_s3_creds_file }}@{{ laika_head_node }}:9002?bucket_prefix=laikaboss-{{ cluster }}-
#storage_save_only=True

scaninfo_logfile=/var/log/laikaboss/metrics.log
scaninfo_summary_logfile=/var/log/laikaboss/summary_metrics.log

#this is only used by the new laikadq daemon
queue_type=redis

# Password DB for local accounts for GUI and REST interfaces for example
# laika_user it contains hashes based on the apache htpassword tools 
user_auth_password_db=/{{ laika_config_base }}/secrets/htpasswd.db

# File containing the redis password for for code which needs redis for using redis 
# directly or to work queue - all components including modules
redis_secret_file={{ laika_config_base }}/secrets/redis_pass

# Server TLS key file used apache and redis
tls_key_file={{ laika_config_base }}/secrets/server.key

# Server TLS cert file used apache and redis
tls_cert_file={{ laika_config_base }}/secrets/server.crt


# The points to a file needed for accessing an S3 service
storage_s3_access_file={{ laika_config_base }}/secrets/s3_access_key

# The points to a secret key file needed for accessing an S3 service
storage_s3_secret_file={{ laika_config_base }}/secrets/s3_secret_key

# The points to a secret key file needed for accessing an S3 service
# it will most likely just be a copy of the storage_s3_access_file and 
# storage_s3_secret_file in one file
storage_s3_creds_file={{ laika_config_base }}/secrets/s3_creds

# used for working with oauth with JWT - NOT WELL TESTED
lb_client_secret_file={{ laika_config_base }}/secrets/lb_client_secret_file

storage_queue_dir=/var/laikaboss/storage-queue
storage_failed_dir=/var/laikaboss/storage-error


#
####################################################################################
# Module Helpers 
####################################################################################
# This section contains configuration options for Laika modules
####################################################################################

[ModuleHelpers]

# The path to the default rule file used by the SCAN_YARA module.
#YaraScanRules=/etc/yara/files.yara

YaraScanRules={{ laika_config_base }}/modules/scan-yara/signatures.yara

# The path to the folder containing all of the Yara sig files
# not needed if the rule argument is already fully qualified
# used by SCAN_YARA module
YaraSigsPath=

# The path to the default rule file used by the DISPOSITIONER module.
YaraDispositionRules={{ laika_config_base }}/modules/dispositioner/disposition.yara

#Maintaining MD5 parity. Adding for META_PE module.
pe_suspicious_resource_md5s={{ laika_config_base }}/modules/suspicious_md5/suspicious_md5s.txt

store_splunk_data=1

####################################################################################
# Logging
####################################################################################
# This section contains configuration options for logging within the Laika 
# framework
####################################################################################

[Logging]

# The syslog facility used for logging by the Laika framework.
logFacility=LOG_LOCAL0

# The syslog tag used for logging by the Laika framework.
logIdentity=laikad

# The syslog level used for module logging.
moduleLogLevel=LOG_INFO

# The syslog level used for scan result logging.
scanLogLevel=LOG_INFO

# Turn module logging on or off (module logs can be verbose)
moduleLogging=False

# Specify a list of sources from which a result will be logged. (default: "all" logs from
# all sources)
logResultFromSource=all

scaninfo_logfile=/var/log/laikaboss/metrics.log
scaninfo_summary_logfile=/var/log/laikaboss/summary_metrics.log

[laikamail]

recipients=scan

[laikarestd]

ldap_timeout_secs = 8
ldap_refresh_interval = 300

[storage-gui]

memorialized_bucket_name = memorialized-storage 

scan_url = https://{{ laika_head_node }}/laika/oauth/scan
scan_status_url = https://{{ laika_head_node }}/laika/oauth/status

[laikacollector]

num_workers = 12
queue_mapping = email:lc-email:5,webui:lc-webui:2,default:laikacollector:1

[laikad]

work_queues = lc-email:10,lc-webui:1,laikacollector:1,redis_work_queue:1
numprocs = 8
